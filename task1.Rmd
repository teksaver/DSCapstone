---
title: "Exploratory Data Analysis"
author: "Sylvain Tenier"
date: "5 juin 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading the file and removing null characters

```{r file load, cache=TRUE}
twittConn <- file("./final/en_US/en_US.twitter.txt","r")
twittLines <- readLines(twittConn,n=-1,skipNul = TRUE)
close(twittConn)
```

## Function to return words and isolated numbers from a line

```{r line words, cache=TRUE}
lineWords <- function(line){
    #replace all punctuation with space
    line <- gsub("[[:punct:]]"," ",line)
    #split by space
    tokens <- strsplit(line, split="[[:space:]]")[[1]]
    #find words with at least 2 letters
    isWord <- sapply(tokens,function(tok){grepl("^[[:alpha:]][[:alpha:]]+$",tok)})
    #find numbers
    isNumber <- sapply(tokens,function(tok){grepl("^[[:digit:]]+$",tok)})
    #return list of words and of numbers
    return(list(words=tokens[isWord], numbers=tokens[isNumber]))
}
```

## Count number of each word
```{r word count, cache=TRUE}
# an environment is the most efficient hash table implementation in R
occur <- new.env()
for (i in 1:length(twittLines)){
    #get the list of words in a line
    words <- lineWords(twittLines[i])$words
    for(word in words){
        word <- tolower(word)
        #if this is the first occurence of the word, add it to the environment
        if(is.null(occur[[word]])){
            occur[[word]] <- 1
        #else increment the number of times the word is seen
        }else{
            occur[[word]] <- occur[[word]] +1
        }
    }
}
```

## Frequency display

```{r frequency display, cache=TRUE}
wordOccDf <- as.data.frame(unlist(as.list(occur)))
library(data.table)
setDT(wordOccDf,keep.rownames = TRUE)
colnames(wordOccDf)<-c("word","occ")
wordOccDf <- wordOccDf[order(-occ),]
wordOccDf
```